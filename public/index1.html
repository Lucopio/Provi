<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Perfil de inversionista</title>
<style>
    :root{
        --provi-green:#11321b;
        --card-radius:12px;
        --card-width: 85%;
        --max-question-width:900px;
        --input-radius:16px;
    }
    body{
        margin:0;font-family:Arial,Helvetica,sans-serif;
        background:var(--provi-green);color:#11321b;
        display:flex;flex-direction:column;align-items:center;
        position: relative; 
    }
    h1{color:#fff;text-align:center;margin:24px 0;}
    .card{width:var(--card-width);max-width:var(--max-question-width);
          background:#fff;border-radius:var(--card-radius);padding:40px 48px;box-sizing:border-box;}
    label{display:block;margin:18px 0 6px;font-weight:bold;}
    select,input[type="text"],input[type="email"]{
        width:100%;padding:12px 14px;border:2px solid #ccc;border-radius:var(--input-radius);
        font-size:1rem;box-sizing:border-box;
    }
    textarea{width:100%;min-height:90px;padding:12px 14px;border-radius:var(--input-radius);
             border:2px solid #ccc;resize:vertical;box-sizing:border-box;}
    .btn{background:#6e6e6e;color:#fff;border:none;padding:14px 42px;font-size:1rem;
         border-radius:30px;cursor:pointer;margin-top:26px;}
    .btn-back{background:#bbb;margin-right:20px;}   /* ‚Üê Bot√≥n Atr√°s m√°s claro */
    .btn[disabled]{opacity:.5;cursor:not-allowed;}
    .hidden{display:none;}
    .typing{min-height:110px;white-space:pre-wrap;}
    .terms-wrapper{display:flex;gap:12px;align-items:flex-start;margin-bottom:20px;}
    .terms-wrapper input{margin-top:4px;}
    @media(max-width:660px){.card{padding:28px 24px;}}
    .provi-report-icon {
      font-size: 1.4em;
      vertical-align: middle;
      margin-right: 0.25em;
    }
    #out h2, #out h3 {
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: bold;
      font-size: 1.4em;
      color: #105028;
      margin-top: 1.2em;
      margin-bottom: 0.6em;
      }
    .perfil-titulo {
  font-size: 1.3em;
  font-family: 'Montserrat', Arial, sans-serif;
  font-weight: bold;
  color: #fff;
  background: #105028;
  padding: 18px 24px 14px 24px;
  border-radius: 14px;
  margin-bottom: 24px;
  box-shadow: 0 3px 24px rgba(0,0,0,0.05);
  letter-spacing: -1px;
  line-height: 1.3;
}
#out p {
  font-size: 1.08em;
  color: #11321b;
  margin: 0 0 16px 0;
  display: flex;
  align-items: flex-start;
  gap: 0.6em;
}
#out .provi-report-icon {
  font-size: 1.2em;
  min-width: 1.8em;
  text-align: center;
  margin-right: 0.2em;
  margin-top: 0.10em;
  flex-shrink: 0;
}
#out b {
      color: #105028;
      font-weight: bold;
    }

    #pantalla-10 {
  background: #11321b !important;      /* Mismo verde del fondo */
  color: #fff !important;
  border-radius: 18px;
  border: 3px solid #fff;              /* L√≠nea blanca alrededor */
  padding: 56px 48px 44px 48px !important;
  min-height: 440px;
  font-family: 'Open Sans', Arial, Helvetica, sans-serif !important;
  max-width: 900px;
  margin: auto;
  box-sizing: border-box;
  box-shadow: 0 6px 36px #0003; 
  text-align: justify;             /* <-- Aqu√≠ */
  text-justify: inter-word;        /* <-- Y aqu√≠ */      
}

#pantalla-10 p {
  color: #fff !important;
  font-size: 1.29em;                   /* Un poco m√°s grande que antes */
  line-height: 1.7;
  margin-top: 0;
  margin-bottom: 1.2em;
  font-family: 'Open Sans', Arial, Helvetica, sans-serif !important;
  letter-spacing: 0.01em;
}

#pantalla-10 .perfil-titulo,
#pantalla-10 p:first-child {
  display: block;
  font-family: 'Montserrat', Arial, Helvetica, sans-serif !important;
  font-size: 2.3em !important;
  font-weight: bold !important;
  color: #fff !important;
  margin-bottom: 0.8em;
  margin-top: 0;
  letter-spacing: -1px;
  text-shadow: 0 2px 18px #0004;
}

@media (max-width: 700px) {
  #pantalla-10 {
    padding: 24px 6px 16px 6px !important;
  }
  #pantalla-10 p, #pantalla-10 .perfil-titulo {
    font-size: 1.05em !important;
  }
}
@media print {
  body {
    background: #11321b !important;
    color: #fff !important;
    margin: 0;
  }

  #pantalla-10 {
    background: #11321b !important;
    color: #fff !important;
    border: none;
    box-shadow: none;
    padding: 40px;
  }

  #pantalla-10 p {
    color: #fff !important;
  }

  #pantalla-10 .perfil-titulo {
    color: #fff !important;
    text-shadow: none;
  }

  #printBtnContainer,
  #logo-provi,
  #pantalla-1,
  #pantalla-2,
  #pantalla-3,
  #pantalla-4,
  #pantalla-5,
  #pantalla-6,
  #pantalla-7,
  #pantalla-8,
  #pantalla-9 {
    display: none !important;
  }
}
</style>
</head>
<body>
  <div style="position: absolute; top: 20px; right: 24px; z-index: 999;">
  <img src="img/logoproviblanco.png" alt="Logo Provi" style="height: 60px;">
</div>

<h1>Perfil de inversionista</h1>

<!-- ########## PANTALLA 1 ########## -->
<section class="card" id="pantalla-1">
  <div class="terms-wrapper">
    <input type="checkbox" id="chkTerms" />
    <label for="chkTerms" style="margin:0;font-weight:normal">
      Acepto los <a href="#" target="_blank">t√©rminos y condiciones</a> y autorizo el tratamiento de datos.
    </label>
  </div>

  <!-- üü¢ Aqu√≠ vuelve el texto con efecto de escritura -->
  <p id="introText" class="typing"></p>

  <!-- üü¢ Este bloque aparece solo cuando termina la animaci√≥n -->
  <div id="introReady" style="display:none; text-align:center; margin-top:24px;">
    <p style="font-weight:bold">
      Si est√°s listo, haz clic en <em>Siguiente</em>
    </p>
    <button class="btn" id="btnNext1" disabled>Siguiente</button>
  </div>
</section>


<!-- ########## PANTALLA 2 ‚Äì Contacto ########## -->
<section class="card hidden" id="pantalla-2">
  <label for="email">Correo electr√≥nico*</label><input type="email" id="email" required />
  <label for="nombre">Nombre completo*</label><input type="text" id="nombre" required />
  <label for="documento">Documento de identificaci√≥n*</label><input type="text" id="documento" required />
  <button class="btn btn-back"  id="btnBack2">Atr√°s</button>
  <button class="btn"          id="btnNext2">Siguiente</button>
</section>

<!-- ########## PANTALLA 3 ‚Äì Demograf√≠a ########## -->
<section class="card hidden" id="pantalla-3">
  <label for="residencia">Lugar de residencia*</label>
  <select id="residencia"><option hidden value="">Selecciona‚Ä¶</option><option>Bogot√°, Colombia</option><option>Medell√≠n, Colombia</option><option>Cali, Colombia</option><option>M√©xico</option><option>Panam√°</option><option>Estados Unidos</option><option>Otro</option></select>

  <label for="edad">¬øCu√°l es tu edad?*</label>
  <select id="edad"><option hidden value="">Selecciona‚Ä¶</option><option>Menos de 30 a√±os</option><option>30-40 a√±os</option><option>40-50 a√±os</option><option>50-60 a√±os</option><option>M√°s de 60 a√±os</option></select>

  <label for="ocupacion">Ocupaci√≥n o actividad principal*</label>
  <select id="ocupacion"><option hidden value="">Selecciona‚Ä¶</option><option>Empleado(a)</option><option>Empresario(a)</option><option>Jubilado(a)</option><option>Otro</option></select>

  <label for="hijos">¬øCu√°ntos hijos tienes?*</label>
  <select id="hijos"><option hidden value="">Selecciona‚Ä¶</option><option>No tengo hijos</option><option>1</option><option>2</option><option>3</option><option>4 o m√°s</option></select>

  <label for="convivencia">¬øCon qui√©n vives actualmente?*</label>
  <select id="convivencia"><option hidden value="">Selecciona‚Ä¶</option><option>Vivo solo/a</option><option>Vivo con mi pareja</option><option>Vivo con mi pareja y mis hijos</option><option>Vivo con familiares o compa√±eros de cuarto</option><option>Otro</option></select>

  <label for="ingresos">¬øCu√°les son los ingresos mensuales combinados‚Ä¶?*</label>
  <select id="ingresos"><option hidden value="">Selecciona‚Ä¶</option><option>Menos de $4,000 USD</option><option>Entre $4,000 USD y $8,000 USD</option><option>Entre $8,000 USD y $12,000 USD</option><option>Entre $12,000 USD y $20,000 USD</option><option>Entre $20,000 USD y $30,000 USD</option><option>M√°s de $30,000 USD</option><option>Prefiero no contestar</option></select>

  <button class="btn btn-back" id="btnBack3">Atr√°s</button>
  <button class="btn"         id="btnNext3">Siguiente</button>
</section>

<!-- ########## PANTALLA 4 ‚Äì Experiencia (1) ########## -->
<section class="card hidden" id="pantalla-4">
  <label for="inv_prev">¬øHas invertido anteriormente en bienes ra√≠ces?*</label>
  <select id="inv_prev"><option hidden value="">Selecciona‚Ä¶</option><option>Si</option><option>No</option></select>

  <label for="tiempo_inv">¬øCu√°nto tiempo llevas invirtiendo en bienes ra√≠ces?*</label>
  <select id="tiempo_inv"><option hidden value="">Selecciona‚Ä¶</option><option>Menos de 1 a√±o</option><option>Entre 1 y 3 a√±os</option><option>Entre 3 y 5 a√±os</option><option>M√°s de 5 a√±os</option></select>

  <label for="tipo_inv_realizadas">¬øQu√© tipo de inversiones inmobiliarias has realizado?*</label>
  <select id="tipo_inv_realizadas">
    <option hidden value="">Selecciona‚Ä¶</option>
    <option>Compra de propiedades para alquilar en renta tradicional</option>
    <option>Compra de propiedades para alquilar en renta corta</option>
    <option>Compra de propiedades para remodelar y vender</option>
    <option>Compra de terrenos o lotes</option>
    <option>Locales comerciales</option>
    <option>Inversi√≥n en proyectos en pre venta</option>
    <option>Otro</option>
  </select>

  <button class="btn btn-back" id="btnBack4">Atr√°s</button>
  <button class="btn"         id="btnNext4">Siguiente</button>
</section>

<!-- ########## PANTALLA 5 ‚Äì Experiencia (2) ########## -->
<section class="card hidden" id="pantalla-5">
  <label for="num_prop">¬øCu√°ntas propiedades has adquirido o vendido?*</label>
  <select id="num_prop"><option hidden value="">Selecciona‚Ä¶</option><option>1 a 3 propiedades</option><option>4 a 10 propiedades</option><option>M√°s de 10 propiedades</option></select>

  <label for="mercados_inv">¬øEn qu√© mercados has invertido?*</label>
  <select id="mercados_inv"><option hidden value="">Selecciona‚Ä¶</option><option>Solo en mi ciudad</option><option>En varias ciudades dentro de mi pa√≠s</option><option>En mercados internacionales</option></select>

  <label for="gestion_prop">¬øTienes experiencia en gestionar propiedades?*</label>
  <select id="gestion_prop"><option hidden value="">Selecciona‚Ä¶</option><option>No tengo experiencia, utilizo un administrador</option><option>Tengo experiencia, lo hago yo mismo</option><option>Otro</option></select>

  <label for="rendimiento">¬øCu√°l ha sido el rendimiento promedio‚Ä¶?*</label>
  <select id="rendimiento"><option hidden value="">Selecciona‚Ä¶</option><option>No lo tengo claro</option><option>Menos del 5% anual</option><option>Entre el 5% y 10% anual</option><option>M√°s del 10% anual</option></select>

  <label for="nivel_exp">¬øCu√°l consideras que es tu nivel de experiencia‚Ä¶?*</label>
  <select id="nivel_exp"><option hidden value="">Selecciona‚Ä¶</option><option>B√°sico</option><option>Intermedio</option><option>Avanzado</option></select>

  <button class="btn btn-back" id="btnBack5">Atr√°s</button>
  <button class="btn"         id="btnNext5">Siguiente</button>
</section>

<!-- ########## PANTALLA 6 ‚Äì Perfil de inter√©s (1) ########## -->
<section class="card hidden" id="pantalla-6">
  <label for="motivacion">¬øCu√°l es tu principal motivaci√≥n‚Ä¶?*</label>
  <select id="motivacion">
    <option hidden value="">Selecciona‚Ä¶</option>
    <option>Generar ingresos pasivos constantes‚Ä¶</option>
    <option>Multiplicar mi capital‚Ä¶</option>
    <option>Obtener liquidez r√°pida‚Ä¶</option>
    <option>Construir un patrimonio‚Ä¶</option>
    <option>Diversificar mi portafolio‚Ä¶</option>
  </select>

  <label for="liquidez">¬øCu√°nto tiempo estar√≠as dispuesto a esperar‚Ä¶?*</label>
  <select id="liquidez"><option hidden value="">Selecciona‚Ä¶</option><option>Inmediato (menos de 6 meses)‚Ä¶</option><option>Corto plazo (6 meses - 2 a√±os)‚Ä¶</option><option>Intermedio (2 - 7 a√±os)‚Ä¶</option><option>Largo plazo (7 - 15 a√±os)‚Ä¶</option><option>Muy largo plazo (m√°s de 15 a√±os)‚Ä¶</option></select>

  <label for="capital">¬øCu√°nto capital tienes disponible‚Ä¶?*</label>
  <select id="capital">
    <option hidden value="">Selecciona‚Ä¶</option>
    <option>No tengo capital inicial</option><option>Entre $0 y $15,000 USD</option><option>Entre $15,000 y $30,000 USD</option><option>Entre $30,000 y $75,000 USD.</option><option>Entre $75,000 y $150,000 USD.</option><option>Entre $150,000 y $300,000 USD.</option><option>Entre $300,000 y $500,000 USD.</option><option>M√°s de $500,000 USD.</option>
  </select>

  <label for="cuotas">¬øCu√°nto dinero tienes disponible para las cuotas?*</label>
  <select id="cuotas"><option hidden value="">Selecciona‚Ä¶</option><option>Menos de $500 USD al mes</option><option>Entre $500 y $1.000 USD al mes</option><option>Entre $1.000 y $1.500 USD al mes</option><option>M√°s de $1.500 USD al mes</option><option>A√∫n no lo hemos definido</option></select>

  <label for="financiamiento">¬øC√≥mo planeas financiar tu inversi√≥n?*</label>
  <select id="financiamiento"><option hidden value="">Selecciona‚Ä¶</option><option>Pago de contado</option><option>Cr√©dito hipotecario</option><option>Mezcla de recursos propios y financiamiento</option><option>Busco socios o inversionistas para apalancamiento</option><option>A√∫n no lo tengo definido</option></select>

  <button class="btn btn-back" id="btnBack6">Atr√°s</button>
  <button class="btn"         id="btnNext6">Siguiente</button>
</section>

<!-- ########## PANTALLA 7 ‚Äì Perfil de inter√©s (2) ########## -->
<section class="card hidden" id="pantalla-7">
  <label for="ubicacion">¬øD√≥nde prefieres invertir?*</label>
  <select id="ubicacion"><option hidden value="">Selecciona‚Ä¶</option><option>Colombia</option><option>En Colombia y otros pa√≠ses de Am√©rica Latina</option><option>En Estados Unidos</option><option>En Panam√°</option><option>En Rep√∫blica Dominicana</option><option>Otro</option></select>

  <label for="moneda">¬øEn qu√© moneda prefieres realizar tu inversi√≥n?*</label>
  <select id="moneda"><option hidden value="">Selecciona‚Ä¶</option><option>Moneda local</option><option>D√≥lares (USD)</option><option>Euros (EUR)</option><option>Otra moneda fuerte‚Ä¶</option><option>Me es indiferente‚Ä¶</option></select>

  <label for="tipo_prop">¬øQu√© tipo de propiedad te interesa m√°s?*</label>
  <select id="tipo_prop">
    <option hidden value="">Selecciona‚Ä¶</option><option>Compra de propiedades para arrendar a largo plazo</option><option>Compra de propiedades para rentas cortas (Airbnb u otras plataformas)</option><option>Inversi√≥n en proyectos en construcci√≥n (preventas)</option><option>Otro</option>
  </select>

  <button class="btn btn-back" id="btnBack7">Atr√°s</button>
  <button class="btn"         id="btnNext7">Siguiente</button>
</section>

<!-- ########## PANTALLA 8 ‚Äì Riesgo ########## -->
<section class="card hidden" id="pantalla-8">
  <label for="fluctuacion">¬øQu√© tan c√≥modo te sientes‚Ä¶?*</label>
  <select id="fluctuacion"><option hidden value="">Selecciona‚Ä¶</option><option>No me siento c√≥modo con ninguna fluctuaci√≥n‚Ä¶</option><option>Prefiero que las fluctuaciones sean peque√±as‚Ä¶</option><option>Estoy dispuesto a aceptar fluctuaciones‚Ä¶</option><option>Me siento c√≥modo y dispuesto a asumir fluctuaciones grandes</option></select>

  <label for="seguridad">¬øQu√© tan importante la seguridad sobre la rentabilidad?*</label>
  <select id="seguridad"><option hidden value="">Selecciona‚Ä¶</option><option>La seguridad es lo m√°s importante‚Ä¶</option><option>Prefiero la seguridad‚Ä¶</option><option>Busco un balance‚Ä¶</option><option>Prefiero priorizar una alta rentabilidad‚Ä¶</option></select>

  <label for="horizonte">¬øCu√°l es tu horizonte de inversi√≥n?*</label>
  <select id="horizonte"><option hidden value="">Selecciona‚Ä¶</option><option>Corto (menos de 1 a√±o)‚Ä¶</option><option>Menos de 3 a√±os‚Ä¶</option><option>Entre 3 a 5 a√±os‚Ä¶</option><option>Largo (m√°s de 5 a√±os)‚Ä¶</option></select>

  <label for="volatilidad">¬øC√≥mo prefieres actuar ante volatilidad?*</label>
  <select id="volatilidad"><option hidden value="">Selecciona‚Ä¶</option><option>Act√∫o r√°pidamente para vender‚Ä¶</option><option>Prefiero reducir mi exposici√≥n‚Ä¶</option><option>Analizo la situaci√≥n‚Ä¶</option><option>Prefiero mantener mi inversi√≥n‚Ä¶</option></select>

  <button class="btn btn-back" id="btnBack8">Atr√°s</button>
  <button class="btn"         id="btnNext8">Siguiente</button>
</section>

<!-- ########## PANTALLA 9 ‚Äì Objetivo & Comentarios ########## -->
<section class="card hidden" id="pantalla-9">
  <label for="objetivo">¬øCu√°l es tu objetivo principal al invertir?*</label>
  <select id="objetivo"><option hidden value="">Selecciona‚Ä¶</option><option>Quiero mantener mi inversi√≥n segura‚Ä¶</option><option>Busco ingresos pasivos con riesgos m√≠nimos</option><option>Rentabilidad estable con algo de riesgo</option><option>Rentabilidad alta y dispuesto a asumir riesgo</option></select>

  <label for="comentarios">Comentarios (opcional)</label>
  <textarea id="comentarios" placeholder="D√©janos cualquier otra informaci√≥n que consideres relevante‚Ä¶"></textarea>

  <button class="btn btn-back" id="btnBack9">Atr√°s</button>
  <button class="btn"         id="btnEnviar">Generar perfil</button>
  <div id="loadingMsg" style="display:none;text-align:center;margin-top:18px;font-size:1.2em;color:#105028"></div>
</section>

<!-- ########## PANTALLA 10 ‚Äì Resultado ########## -->
<section class="card hidden" id="pantalla-10"><div id="out"></div></section>
<div id="printBtnContainer" style="text-align:right; margin-top:28px; display:none;">
  <button id="btnPrintPerfil" class="btn" style="background:#fff; color:#105028; font-weight:bold; border:2px solid #105028; font-size:1em; padding:10px 32px; border-radius:28px; cursor:pointer;">
    Imprimir o guardar PDF
  </button>
</div>

<script>
/*--------------------------------------------------
  1Ô∏è‚É£  EFECTO DE ESCRITURA EN P√ÅGINA 1
--------------------------------------------------*/
const introTxt=`Querido inversionista, ¬°Bienvenido a la primera parte del proceso!\nA continuaci√≥n, te invitamos a diligenciar el siguiente formulario, el cual nos permitir√° conocer tu perfil de inversionista, entender cu√°les son tus intereses de inversi√≥n, tu perfil financiero, tu perfil de riesgo y, as√≠, presentarte proyectos que realmente se ajusten a tus objetivos y necesidades.`;
let idx=0;
let introTerminado = false;

function verificarListo() {
  if (introTerminado && chkTerms.checked) {
    btnNext1.disabled = false;
  } else {
    btnNext1.disabled = true;
  }
}
const introEl=document.getElementById('introText');
function typeIntro() {
  if (idx < introTxt.length) {
    introEl.textContent += introTxt.charAt(idx++);
    setTimeout(typeIntro, 25);
  } else {
    introTerminado = true;
    document.getElementById('introReady').style.display = 'block';
    verificarListo(); // üëà revisa si puede habilitar el bot√≥n
  }
}
typeIntro();

//---- navegaci√≥n segura con validaci√≥n ----//

function show(id){
  document.querySelectorAll('.card').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// Pantalla 1: T√©rminos
chkTerms.onchange = verificarListo;
btnNext1.onclick = () => show('pantalla-2');

// Pantalla 2: Contacto
btnBack2.onclick = () => show('pantalla-1');
btnNext2.onclick = () => {
  if (!email.value || !nombre.value || !documento.value) {
    alert('Por favor completa todos los campos obligatorios antes de continuar.');
    return;
  }
  show('pantalla-3');
};

// Pantalla 3: Demograf√≠a
btnBack3.onclick = () => show('pantalla-2');
btnNext3.onclick = () => {
  if (!residencia.value || !edad.value || !ocupacion.value || !hijos.value || !convivencia.value || !ingresos.value) {
    alert('Por favor responde todas las preguntas antes de continuar.');
    return;
  }
  show('pantalla-4');
};

// Pantalla 4: Experiencia (1)
btnBack4.onclick = () => show('pantalla-3');
btnNext4.onclick = () => {
  if (!inv_prev.value || !tiempo_inv.value || !tipo_inv_realizadas.value) {
    alert('Por favor responde todas las preguntas antes de continuar.');
    return;
  }
  show('pantalla-5');
};

// Pantalla 5: Experiencia (2)
btnBack5.onclick = () => show('pantalla-4');
btnNext5.onclick = () => {
  if (!num_prop.value || !mercados_inv.value || !gestion_prop.value || !rendimiento.value || !nivel_exp.value) {
    alert('Por favor responde todas las preguntas antes de continuar.');
    return;
  }
  show('pantalla-6');
};

// Pantalla 6: Perfil de inter√©s (1)
btnBack6.onclick = () => show('pantalla-5');
btnNext6.onclick = () => {
  if (!motivacion.value || !liquidez.value || !capital.value || !cuotas.value || !financiamiento.value) {
    alert('Por favor responde todas las preguntas antes de continuar.');
    return;
  }
  show('pantalla-7');
};

// Pantalla 7: Perfil de inter√©s (2)
btnBack7.onclick = () => show('pantalla-6');
btnNext7.onclick = () => {
  if (!ubicacion.value || !moneda.value || !tipo_prop.value) {
    alert('Por favor responde todas las preguntas antes de continuar.');
    return;
  }
  show('pantalla-8');
};

// Pantalla 8: Riesgo
btnBack8.onclick = () => show('pantalla-7');
btnNext8.onclick = () => {
  if (!fluctuacion.value || !seguridad.value || !horizonte.value || !volatilidad.value) {
    alert('Por favor responde todas las preguntas antes de continuar.');
    return;
  }
  show('pantalla-9');
};

// Pantalla 9: Objetivo & Comentarios
btnBack9.onclick = () => show('pantalla-8');
// Siguiente aqu√≠ es "Generar Perfil" (validaci√≥n completa se hace al enviar)

/*------ env√≠o al backend ------*/
btnEnviar.onclick = async () => {
  const respuestas = {
    email: email.value,
    nombre: nombre.value,
    documento: documento.value,
    residencia: residencia.value,
    edad: edad.value,
    ocupacion: ocupacion.value,
    hijos: hijos.value,
    convivencia: convivencia.value,
    ingresos: ingresos.value,
    inv_prev: inv_prev.value,
    tiempo_inv: tiempo_inv.value,
    tipo_inv_realizadas: tipo_inv_realizadas.value,
    num_prop: num_prop.value,
    mercados_inv: mercados_inv.value,
    gestion_prop: gestion_prop.value,
    rendimiento: rendimiento.value,
    nivel_exp: nivel_exp.value,
    motivacion: motivacion.value,
    liquidez: liquidez.value,
    capital: capital.value,
    cuotas: cuotas.value,
    financiamiento: financiamiento.value,
    ubicacion: ubicacion.value,
    moneda: moneda.value,
    tipo_prop: tipo_prop.value,
    fluctuacion: fluctuacion.value,
    seguridad: seguridad.value,
    horizonte: horizonte.value,
    volatilidad: volatilidad.value,
    objetivo: objetivo.value,
    comentarios: comentarios.value
  };

  loadingMsg.style.display = 'block';
  loadingMsg.innerHTML = '‚è≥ Generando tu perfil, por favor espera...';

  // ------ CORREGIDO: El fetch va directo aqu√≠, no dentro de una funci√≥n anidada ------
  try {
    btnEnviar.disabled = true;
    const r = await fetch('https://provi-backend.onrender.com/api/perfiles', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(respuestas)
    });

    if (!r.ok) {
      let msg = 'Error desconocido';
      try {
        const data = await r.json();
        msg = data.error || msg;
      } catch {
        msg = 'Error inesperado';
      }
      out.innerHTML = `<p style="color:red">‚ö† ${msg}</p>`;
      show('pantalla-10');
      loadingMsg.style.display = 'none';
      btnEnviar.disabled = false;
      return;
    }

    let perfil = '';
    try {
      const data = await r.json();
      perfil = data.perfil;
    } catch {
      out.innerHTML = `<p style="color:red">‚ö† Respuesta inesperada del servidor</p>`;
      show('pantalla-10');
      loadingMsg.style.display = 'none';
      btnEnviar.disabled = false;
      return;
    }

    out.innerHTML = perfil
      .split(/\n\s*\n/)
      .map(par => `<p>${par.trim()}</p>`)
      .join('');
    show('pantalla-10');
    loadingMsg.style.display = 'none';
    btnPrintPerfil && (printBtnContainer.style.display = 'block');

  } catch (err) {
    out.innerHTML = `<p style="color:red">‚ö† ${err.message.includes('fetch') ? 'No se pudo conectar al servidor. Intenta de nuevo.' : err.message}</p>`;
    show('pantalla-10');
    loadingMsg.style.display = 'none';
  } finally {
    btnEnviar.disabled = false;
  }
};

btnPrintPerfil.onclick = function() {
  window.print();
};
</script>
</body>
</html>
